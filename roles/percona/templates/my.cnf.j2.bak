#
# The Percona Server 8.0 configuration file.
#
# For explanations see
# http://dev.mysql.com/doc/mysql/en/server-system-variables.html
#
#
# * IMPORTANT: Additional settings that can override those from this file!
#   The files must end with '.cnf', otherwise they'll be ignored.
#

[mysqld]
datadir=/var/lib/mysql
user=mysql
binlog_format=ROW
bind-address={{ ansible_host }}
skip-name-resolve
expire_logs_days=3

collation-server = utf8mb4_unicode_520_ci
init-connect='SET NAMES utf8mb4'
character-set-server = utf8mb4

max_connections=5000
server_id=1
log_bin=percona-bin
log_slave_updates
enforce_gtid_consistency=ON
gtid_mode=on
relay_log_space_limit=10G
relay_log_purge=on

#replicate-do-db=keystone

# InnoDB Configuration
default_storage_engine=innodb
innodb_autoinc_lock_mode=2
innodb_flush_log_at_trx_commit=0
innodb_buffer_pool_size=122M
innodb_file_per_table = on
max_connections = 4096

wsrep_provider=/usr/lib/libgalera_smm.so
wsrep_cluster_name=vargostack_mysql_cluster
wsrep_cluster_address=gcomm://185.88.135.160,185.88.135.68,185.88.35.123
wsrep_node_name={{ ansible_hostname }}
wsrep_node_address=185.88.135.{{hostvars[inventory_hostname]['ansible_env'].SSH_CONNECTION.split(' ')[2].split('.')[3]}}
wsrep_provider_options="socket.ssl_key=server-key.pem;socket.ssl_cert=server-cert.pem;socket.ssl_ca=ca.pem"
wsrep_slave_threads=8
wsrep_log_conflicts
innodb_autoinc_lock_mode=2

wsrep_sst_method=xtrabackup-v2
pxc_strict_mode=ENFORCING

[sst]
encrypt=4
ssl-key=server-key.pem
ssl-ca=ca.pem
ssl-cert=server-cert.pem

!includedir /etc/mysql/conf.d/
